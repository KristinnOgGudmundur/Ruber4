@(driver: is.ru.honn.ruber.domain.DriverDTO, commentForm: Form[is.ru.honn.ruber.domain.Review], average: Double))

@import helper._
@import twitterBootstrap._

@main("Home") {

    @if(session.get("username")) {

        <head>
            <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
			<script src="@routes.Assets.at("javascripts/details.js")" type="text/javascript"></script>
        </head>

        <h1 id="drivername">@driver.getName</h1>

        <div class="driverinfo">
            <h3>Car: @driver.getCar()</h3>
            <h3>Average rating: @average</h3>
        </div>

        <h2>@driver.getName's Reviews:</h2>

        <table id="myTable">
            <tbody>
                <tr>
                    <th>Rating</th>
                    <th>Comment</th>
                </tr>
            </tbody>
        </table>


        <div id="border">
            <div id="hiddeMe" class="reviewform">
            @helper.form(action = routes.DriverController.rateDriver(),'id -> "form") {
                <fieldset>
                    <legend>My Review</legend>

					@inputRadioGroup(
                        commentForm("score"),
                        options = options("0"->"0", "1"->"1","2"->"2","3"->"3","4"->"4","5"->"5"),
                        '_label -> "Rate!",
                        'id -> "myradio",
                        'class -> "radio",
                        'required -> true
                    )


					<span></span>
                    @textarea(
                        commentForm("content"),
                        '_label -> "Comment!",
                        'id -> "mytext",
                        'required -> true
                    )

                </fieldset>
                <span id="formerror">Must fill out all fields</span>
                <div class="actions">
                    <input type="button" onclick="add()" class="btnprimary" value="Add">
                </div>
            </div>
        </div>


        <input type="button" id="hiddebutton" onclick="show()" value="Add Review">

        <script type="text/javascript">

        $( document ).ready(function() {
            getComments(1);
        });

        function show() {
        document.getElementById('hiddebutton' ).style.display = "none";
        document.getElementById('hiddeMe').style.display = "inline";
        document.getElementById('border').style.border = "solid #808080";
        }

        function hideAndClear() {
        $ ( '#mytext' ).val ('' ) ;
        $ ( 'input[name=score]:checked', '#form' ).removeAttr("checked");
        document.getElementById('hiddebutton' ).style.display = "inline";
        document.getElementById('hiddeMe').style.display = "none";
        document.getElementById('border').style.border = "none";
        }

        function add() {

            if($( '#mytext' ).val ( ).length === 0 || !$("input[name='score']:checked").val())
            {
                $('#formerror' ).css("display", "inline");
            }
            else
            {
                $('#formerror' ).css("display", "none   ");
                var text = $ ( '#mytext' ).val ( ) ;
                var radio = $ ( 'input[name=score]:checked', '#form' ).val ( ) ;
                var url = $ ( "#form" ).attr ( "action" ) ;
                var user;
                var myusername =  $('#myusername' ).text();
                var drivername = $('#drivername' ).text();

                //Getting the userId for the user
                $.ajax({
                async: false,
                type: 'GET',
                url: 'http://localhost:9000/api/user/' + myusername,
                success: function(data) {
                user = $.parseJSON(data)
                }
                });
                var userid = user.id;
                var reviewinfo = { "content": text.toString(), "score": radio.toString(), userId: userid.toString(), driverName: drivername.toString() }

                //Posting the review
                $.ajax({
                type: "POST",
                url: url,
                data: JSON.stringify({ Info: reviewinfo }),
                contentType: "application/json; charset=utf-8",
                dataType: "json"
                })
                .done(function( msg ) {
                    getComments(msg.driverId.toString());
                })
                .fail(function( msg ) {
                })
                .always(function() {
                });
            }
        }

        function getComments(myDriverId)
        {
            $.ajax({
            type: "GET",
            url: 'http://localhost:9000/driver/reviews/driverId',
            data: {driverId: myDriverId},
            contentType: "application/json; charset=utf-8",
            dataType: "json"
            })
            .done(function( data ) {
                updateComments(data.reviews);
                hideAndClear();
                $('tr:last').get(0).scrollIntoView();
            })
            .fail(function( data ) {
            })
            .always(function() {
            });
        }

        function updateComments(reviews)
        {
            $.each(reviews, function(i, obj) {
                $("#myTable").find('tbody').append($('<tr><td>' + obj.score.toString() + '</td><td>'+  obj.content.toString() + '</td></tr>'))
            });
        }
        </script>
    }
    } else {

        <h2>This is not the Site you are looking for</h2>

    }
}